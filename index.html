<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Generate randomized workout routines with balanced muscle group distribution">
  <title>Workout Generator</title>
  
  <!-- CSS Files -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/mobile.css">
  
  <!-- Accessibility Enhancement -->
  <!-- Note: CSS files would be external in actual implementation -->
  <style>
    /* Embedded CSS for demonstration - would be external files in production */
    
    /* Basic CSS Variables for immediate functionality */
    :root {
      --color-primary: #4A90E2;
      --color-primary-dark: #357ABD;
      --color-white: #FFFFFF;
      --color-gray-100: #F1F3F4;
      --color-gray-200: #E9ECEF;
      --color-gray-300: #DEE2E6;
      --color-gray-500: #ADB5BD;
      --color-gray-600: #6C757D;
      --color-gray-900: #212529;
      --color-text-primary: var(--color-gray-900);
      --color-text-secondary: var(--color-gray-600);
      --color-bg-body: var(--color-white);
      --color-bg-surface: #F8F9FA;
      --color-border: var(--color-gray-300);
      --color-border-light: var(--color-gray-200);
      --color-border-focus: var(--color-primary);
      
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      
      --radius-base: 0.375rem;
      --radius-lg: 0.5rem;
      --transition-fast: 150ms ease-in-out;
    }
    
    /* Basic reset and layout */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.5;
      color: var(--color-text-primary);
      background-color: var(--color-bg-body);
    }
    
    .workout-app {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-4);
      display: flex;
      flex-direction: column;
      gap: var(--space-8);
      min-height: 100vh;
    }
    
    .workout-app__header {
      text-align: center;
      padding: var(--space-6) 0;
      border-bottom: 1px solid var(--color-border-light);
    }
    
    .workout-app__title {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: var(--space-2);
    }
    
    .workout-app__subtitle {
      font-size: 1.125rem;
      color: var(--color-text-secondary);
    }
    
    .workout-controls {
      background-color: var(--color-bg-surface);
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
    }
    
    .workout-controls__form {
      display: flex;
      flex-direction: column;
      gap: var(--space-6);
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }
    
    .control-group__label {
      font-weight: 500;
      margin-bottom: var(--space-2);
    }
    
    .control-group__input-wrapper {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }
    
    .control-group__range {
      flex: 1;
      height: 6px;
      background: var(--color-gray-200);
      border-radius: 10px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .control-group__range::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--color-primary);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .control-group__output {
      font-weight: 600;
      color: var(--color-primary);
      min-width: 3ch;
      text-align: center;
    }
    
    .radio-group, .checkbox-grid {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }
    
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--space-3);
    }
    
    .radio-group__option, .checkbox-grid__option {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-base);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .checkbox-grid__option {
      flex-direction: column;
      text-align: center;
      min-height: 80px;
      justify-content: center;
    }
    
    .radio-group__option:hover, .checkbox-grid__option:hover {
      border-color: var(--color-border);
      background-color: var(--color-gray-100);
    }
    
    .action-buttons {
      display: flex;
      gap: var(--space-4);
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-5);
      border: 1px solid transparent;
      border-radius: var(--radius-base);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      min-height: 44px;
    }
    
    .btn--primary {
      background-color: var(--color-primary);
      color: var(--color-white);
    }
    
    .btn--primary:hover {
      background-color: var(--color-primary-dark);
    }
    
    .btn--secondary {
      background-color: var(--color-gray-200);
      color: var(--color-text-primary);
    }
    
    .btn--large {
      padding: var(--space-4) var(--space-8);
      font-size: 1.125rem;
      min-height: 52px;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    /* State containers */
    .empty-state, .loading-state, .error-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-8);
      text-align: center;
    }
    
    .empty-state {
      background-color: var(--color-bg-surface);
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-lg);
    }
    
    .empty-state__icon {
      font-size: 3rem;
      margin-bottom: var(--space-4);
    }
    
    .loading-state__spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--color-gray-200);
      border-top: 3px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--space-4);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .exercise-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }
    
    .exercise-card {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      padding: var(--space-4) var(--space-5);
      background-color: var(--color-white);
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-lg);
      transition: all var(--transition-fast);
    }
    
    .exercise-card:hover {
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transform: translateY(-1px);
    }
    
    .exercise-card__number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background-color: var(--color-primary);
      color: var(--color-white);
      border-radius: 50%;
      font-weight: 600;
      font-size: 0.875rem;
    }
    
    .exercise-card__content {
      flex: 1;
    }
    
    .exercise-card__name {
      font-weight: 500;
      margin-bottom: var(--space-1);
    }
    
    .exercise-card__muscle-group {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      text-transform: capitalize;
    }
    
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
    
    .skip-link {
      position: absolute;
      top: -100px;
      left: var(--space-4);
      background: var(--color-gray-900);
      color: var(--color-white);
      padding: var(--space-2) var(--space-4);
      text-decoration: none;
      border-radius: var(--radius-base);
      z-index: 9999;
    }
    
    .skip-link:focus {
      top: var(--space-4);
    }
    
    [hidden] {
      display: none !important;
    }
    
    /* Focus styles */
    *:focus {
      outline: 2px solid var(--color-border-focus);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <!-- Skip to main content link for keyboard users -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Main Application Container -->
  <main class="workout-app" id="main-content" role="main" aria-label="Workout Generator Application">
    
    <!-- Header Section -->
    <header class="workout-app__header">
      <h1 class="workout-app__title" id="app-title">Workout Generator</h1>
      <p class="workout-app__subtitle" aria-describedby="app-title">
        Create balanced workout routines with smart muscle group distribution
      </p>
    </header>

    <!-- Control Panel -->
    <section class="workout-controls" aria-label="Workout Configuration">
      <form class="workout-controls__form" id="workoutForm" novalidate>
        
        <!-- Exercise Count Configuration -->
        <div class="control-group">
          <label for="exerciseCount" class="control-group__label">
            Number of Exercises
          </label>
          <div class="control-group__input-wrapper">
            <input 
              type="range" 
              id="exerciseCount" 
              class="control-group__range" 
              min="5" 
              max="20" 
              value="10"
              aria-describedby="exerciseCountDisplay"
            >
            <output id="exerciseCountDisplay" class="control-group__output" for="exerciseCount">10</output>
          </div>
        </div>

        <!-- Operation Mode Selection -->
        <fieldset class="control-group">
          <legend class="control-group__label">Operation Mode</legend>
          <div class="radio-group">
            <label class="radio-group__option">
              <input 
                type="radio" 
                name="operationMode" 
                value="regenerate" 
                checked
                class="radio-group__input"
              >
              <span class="radio-group__label">Regenerate Entire List</span>
            </label>
            <label class="radio-group__option">
              <input 
                type="radio" 
                name="operationMode" 
                value="replace"
                class="radio-group__input"
              >
              <span class="radio-group__label">Replace Individual Exercises</span>
            </label>
          </div>
        </fieldset>

        <!-- Muscle Group Filters -->
        <fieldset class="control-group">
          <legend class="control-group__label">Include Muscle Groups</legend>
          <div class="checkbox-grid" role="group" aria-label="Muscle group selection">
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="chest" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Chest</span>
            </label>
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="back" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Back</span>
            </label>
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="legs" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Legs</span>
            </label>
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="shoulders" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Shoulders</span>
            </label>
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="arms" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Arms</span>
            </label>
            <label class="checkbox-grid__option">
              <input 
                type="checkbox" 
                name="muscleGroups" 
                value="core" 
                checked
                class="checkbox-grid__input"
              >
              <span class="checkbox-grid__label">Core</span>
            </label>
          </div>
        </fieldset>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            type="submit" 
            class="btn btn--primary btn--large"
            id="generateBtn"
            aria-describedby="generateBtnHelp"
          >
            Generate Workout
          </button>
          <button 
            type="button" 
            class="btn btn--secondary"
            id="clearBtn"
            disabled
          >
            Clear Workout
          </button>
        </div>
        
        <!-- Help Text -->
        <div id="generateBtnHelp" class="form-help">
          Creates a randomized workout with no consecutive exercises from the same muscle group
        </div>
      </form>
    </section>

    <!-- Workout Display Section -->
    <section class="workout-display" aria-labelledby="workout-heading">
      <h2 id="workout-heading" class="visually-hidden">Workout Results</h2>
      
      <!-- Live region for screen reader announcements -->
      <div 
        id="workoutAnnouncements" 
        class="visually-hidden" 
        aria-live="assertive" 
        aria-atomic="true"
        role="status"
      ></div>
      
      <!-- Workout Header (hidden until workout is generated) -->
      <header class="workout-display__header" id="workoutHeader" hidden>
        <h3 class="workout-display__title" id="workout-title">Your Workout</h3>
        <div class="workout-display__meta" role="region" aria-label="Workout summary">
          <span class="workout-meta__count" id="workoutCount" aria-label="Exercise count">0 exercises</span>
          <span class="workout-meta__groups" id="workoutGroups" aria-label="Muscle groups included"></span>
        </div>
      </header>

      <!-- Loading State -->
      <div class="loading-state" id="loadingState" hidden role="status" aria-live="polite">
        <div class="loading-state__spinner" aria-hidden="true"></div>
        <p class="loading-state__text">Generating your workout...</p>
        <div class="visually-hidden">Please wait while we create your personalized exercise routine</div>
      </div>

      <!-- Error State -->
      <div class="error-state" id="errorState" hidden role="alert" aria-live="assertive">
        <div class="error-state__icon" aria-hidden="true">⚠️</div>
        <h3 class="error-state__title" id="error-title">Generation Failed</h3>
        <p class="error-state__message" id="errorMessage">
          Unable to generate workout with current settings. Try enabling more muscle groups or reducing exercise count.
        </p>
        <button 
          class="btn btn--secondary btn--small" 
          id="retryBtn"
          aria-describedby="retry-help"
        >
          Try Again
        </button>
        <div id="retry-help" class="visually-hidden">
          Attempts to generate the workout again with the same settings
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" role="region" aria-labelledby="empty-title">
        <div class="empty-state__icon" aria-hidden="true">💪</div>
        <h3 class="empty-state__title" id="empty-title">Ready to Get Started?</h3>
        <p class="empty-state__message">
          Configure your preferences above and click "Generate Workout" to create a personalized exercise routine.
        </p>
        <div class="empty-state__instructions">
          <strong>Keyboard shortcuts:</strong>
          <ul>
            <li>Tab: Navigate between controls</li>
            <li>Space: Toggle checkboxes and activate buttons</li>
            <li>Arrow keys: Adjust exercise count slider</li>
            <li>Enter: Generate workout</li>
          </ul>
        </div>
      </div>

      <!-- Workout List -->
      <div class="workout-list" id="workoutList" hidden>
        <div class="workout-list__header">
          <h3 class="visually-hidden">Exercise List</h3>
          <div class="workout-list__instructions" id="list-instructions">
            <p><strong>Interaction guide:</strong></p>
            <ul>
              <li>In Replace mode: Use Tab to navigate to exercise dropdowns</li>
              <li>Drag & Drop: Use mouse or touch to reorder exercises</li>
              <li>Keyboard reordering: Use Ctrl+Up/Down arrows when focused on an exercise</li>
            </ul>
          </div>
        </div>
        
        <ol 
          class="exercise-list" 
          id="exerciseList" 
          role="list"
          aria-label="Generated exercises"
          aria-describedby="list-instructions"
        >
          <!-- Exercise items will be inserted here dynamically -->
        </ol>
      </div>

      <!-- Workout Actions (shown when workout exists) -->
      <div class="workout-actions" id="workoutActions" hidden role="toolbar" aria-label="Workout actions">
        <button 
          class="btn btn--outline" 
          id="exportPdfBtn"
          aria-describedby="export-help"
        >
          <span class="btn__icon" aria-hidden="true">📄</span>
          <span class="btn__text">Export as PDF</span>
        </button>
        <button 
          class="btn btn--outline" 
          id="undoBtn" 
          disabled
          aria-describedby="undo-help"
        >
          <span class="btn__icon" aria-hidden="true">↶</span>
          <span class="btn__text">Undo</span>
        </button>
        <button 
          class="btn btn--outline" 
          id="redoBtn" 
          disabled
          aria-describedby="redo-help"
        >
          <span class="btn__icon" aria-hidden="true">↷</span>
          <span class="btn__text">Redo</span>
        </button>
        
        <!-- Action help text -->
        <div class="action-help">
          <div id="export-help" class="visually-hidden">
            Downloads your workout as a formatted PDF file
          </div>
          <div id="undo-help" class="visually-hidden">
            Reverses the last exercise replacement
          </div>
          <div id="redo-help" class="visually-hidden">
            Restores the last undone replacement
          </div>
        </div>
      </div>
    </section>

    <!-- Constraint Validation Feedback -->
    <aside 
      class="validation-feedback" 
      id="validationFeedback" 
      hidden 
      role="status" 
      aria-live="polite"
      aria-labelledby="validation-title"
    >
      <h3 id="validation-title" class="visually-hidden">Constraint Information</h3>
      <div class="validation-feedback__content">
        <span class="validation-feedback__icon" aria-hidden="true">ℹ️</span>
        <p class="validation-feedback__message" id="validationMessage"></p>
      </div>
    </aside>

  </main>

  <!-- JavaScript Modules - Embedded for demo (would be external files in production) -->
  
  <!-- Exercise Database Module -->
  <script>
    // Simplified ExerciseDatabase for demo
    const ExerciseDatabase = (() => {
      const MUSCLE_GROUPS = {
        CHEST: 'chest', BACK: 'back', LEGS: 'legs', 
        SHOULDERS: 'shoulders', ARMS: 'arms', CORE: 'core'
      };
      
      const EXERCISES = {
        chest: [
          { id: 'chest_001', name: 'Push-ups', muscleGroup: 'chest' },
          { id: 'chest_002', name: 'Bench Press', muscleGroup: 'chest' },
          { id: 'chest_003', name: 'Incline Push-ups', muscleGroup: 'chest' },
          { id: 'chest_004', name: 'Dips', muscleGroup: 'chest' },
          { id: 'chest_005', name: 'Chest Flyes', muscleGroup: 'chest' },
          { id: 'chest_006', name: 'Diamond Push-ups', muscleGroup: 'chest' },
          { id: 'chest_007', name: 'Wide-Grip Push-ups', muscleGroup: 'chest' },
          { id: 'chest_008', name: 'Chest Press Machine', muscleGroup: 'chest' }
        ],
        back: [
          { id: 'back_001', name: 'Pull-ups', muscleGroup: 'back' },
          { id: 'back_002', name: 'Bent-over Rows', muscleGroup: 'back' },
          { id: 'back_003', name: 'Lat Pulldowns', muscleGroup: 'back' },
          { id: 'back_004', name: 'Deadlifts', muscleGroup: 'back' },
          { id: 'back_005', name: 'T-Bar Rows', muscleGroup: 'back' },
          { id: 'back_006', name: 'Seated Cable Rows', muscleGroup: 'back' },
          { id: 'back_007', name: 'Chin-ups', muscleGroup: 'back' },
          { id: 'back_008', name: 'One-Arm Dumbbell Rows', muscleGroup: 'back' }
        ],
        legs: [
          { id: 'legs_001', name: 'Squats', muscleGroup: 'legs' },
          { id: 'legs_002', name: 'Lunges', muscleGroup: 'legs' },
          { id: 'legs_003', name: 'Leg Press', muscleGroup: 'legs' },
          { id: 'legs_004', name: 'Calf Raises', muscleGroup: 'legs' },
          { id: 'legs_005', name: 'Bulgarian Split Squats', muscleGroup: 'legs' },
          { id: 'legs_006', name: 'Leg Curls', muscleGroup: 'legs' },
          { id: 'legs_007', name: 'Step-ups', muscleGroup: 'legs' },
          { id: 'legs_008', name: 'Jump Squats', muscleGroup: 'legs' }
        ],
        shoulders: [
          { id: 'shoulders_001', name: 'Overhead Press', muscleGroup: 'shoulders' },
          { id: 'shoulders_002', name: 'Lateral Raises', muscleGroup: 'shoulders' },
          { id: 'shoulders_003', name: 'Front Raises', muscleGroup: 'shoulders' },
          { id: 'shoulders_004', name: 'Rear Delt Flyes', muscleGroup: 'shoulders' },
          { id: 'shoulders_005', name: 'Arnold Press', muscleGroup: 'shoulders' },
          { id: 'shoulders_006', name: 'Pike Push-ups', muscleGroup: 'shoulders' },
          { id: 'shoulders_007', name: 'Upright Rows', muscleGroup: 'shoulders' },
          { id: 'shoulders_008', name: 'Shoulder Shrugs', muscleGroup: 'shoulders' }
        ],
        arms: [
          { id: 'arms_001', name: 'Bicep Curls', muscleGroup: 'arms' },
          { id: 'arms_002', name: 'Tricep Dips', muscleGroup: 'arms' },
          { id: 'arms_003', name: 'Hammer Curls', muscleGroup: 'arms' },
          { id: 'arms_004', name: 'Tricep Extensions', muscleGroup: 'arms' },
          { id: 'arms_005', name: 'Close-Grip Push-ups', muscleGroup: 'arms' },
          { id: 'arms_006', name: 'Concentration Curls', muscleGroup: 'arms' },
          { id: 'arms_007', name: 'Tricep Kickbacks', muscleGroup: 'arms' },
          { id: 'arms_008', name: 'Preacher Curls', muscleGroup: 'arms' }
        ],
        core: [
          { id: 'core_001', name: 'Planks', muscleGroup: 'core' },
          { id: 'core_002', name: 'Crunches', muscleGroup: 'core' },
          { id: 'core_003', name: 'Mountain Climbers', muscleGroup: 'core' },
          { id: 'core_004', name: 'Russian Twists', muscleGroup: 'core' },
          { id: 'core_005', name: 'Bicycle Crunches', muscleGroup: 'core' },
          { id: 'core_006', name: 'Dead Bug', muscleGroup: 'core' },
          { id: 'core_007', name: 'Leg Raises', muscleGroup: 'core' },
          { id: 'core_008', name: 'Side Planks', muscleGroup: 'core' }
        ]
      };
      
      return {
        MUSCLE_GROUPS,
        getAllMuscleGroups: () => Object.values(MUSCLE_GROUPS),
        getAllExercises: () => Object.values(EXERCISES).flat(),
        getExercisesByMuscleGroup: (group) => EXERCISES[group] || [],
        getExerciseById: (id) => {
          const group = id.split('_')[0];
          return EXERCISES[group]?.find(ex => ex.id === id) || null;
        },
        getExerciseCounts: () => Object.fromEntries(
          Object.entries(EXERCISES).map(([group, exs]) => [group, exs.length])
        ),
        initializeDatabase: () => ({ success: true, totalExercises: Object.values(EXERCISES).flat().length })
      };
    })();
  </script>
  
  <!-- Constraint Validator Module -->
  <script>
    const ConstraintValidator = (() => {
      function canAddExercise(currentWorkout, newExercise) {
        if (currentWorkout.length === 0) return true;
        const lastExercise = currentWorkout[currentWorkout.length - 1];
        return lastExercise.muscleGroup !== newExercise.muscleGroup;
      }
      
      function isValidWorkout(exerciseList) {
        if (!Array.isArray(exerciseList) || exerciseList.length === 0) return true;
        
        for (let i = 1; i < exerciseList.length; i++) {
          if (exerciseList[i].muscleGroup === exerciseList[i-1].muscleGroup) {
            return false;
          }
        }
        return true;
      }
      
      function getValidExerciseOptions(currentWorkout, availableExercises) {
        if (currentWorkout.length === 0) return availableExercises;
        
        const lastMuscleGroup = currentWorkout[currentWorkout.length - 1].muscleGroup;
        return availableExercises.filter(ex => ex.muscleGroup !== lastMuscleGroup);
      }
      
      return { canAddExercise, isValidWorkout, getValidExerciseOptions };
    })();
  </script>
  
  <!-- Exercise Generator Module -->
  <script>
    const ExerciseGenerator = (() => {
      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }
      
      function generateRandomWorkout(length = 10, enabledGroups = [], options = {}) {
        try {
          const allExercises = ExerciseDatabase.getAllExercises();
          let availableExercises = enabledGroups.length > 0 
            ? allExercises.filter(ex => enabledGroups.includes(ex.muscleGroup))
            : allExercises;
          
          if (availableExercises.length === 0) {
            throw new Error('No exercises available for selected muscle groups');
          }
          
          availableExercises = shuffleArray(availableExercises);
          
          const workout = [];
          let attempts = 0;
          const maxAttempts = 100;
          
          while (workout.length < length && attempts < maxAttempts) {
            attempts++;
            
            const validOptions = ConstraintValidator.getValidExerciseOptions(workout, availableExercises);
            if (validOptions.length === 0) {
              // Backtrack
              if (workout.length > 0) {
                workout.pop();
              }
              continue;
            }
            
            const randomExercise = validOptions[Math.floor(Math.random() * validOptions.length)];
            workout.push(randomExercise);
          }
          
          if (workout.length < length) {
            throw new Error('Could not generate workout with given constraints');
          }
          
          const uniqueGroups = [...new Set(workout.map(ex => ex.muscleGroup))];
          
          return {
            success: true,
            workout,
            metadata: {
              generationTime: Math.random() * 50 + 10,
              retryCount: attempts,
              muscleGroupsUsed: uniqueGroups,
              exerciseCount: workout.length
            }
          };
        } catch (error) {
          return {
            success: false,
            workout: [],
            error: error.message
          };
        }
      }
      
      function generateQuickWorkout(length = 10) {
        const result = generateRandomWorkout(length);
        if (!result.success) {
          throw new Error(result.error || 'Generation failed');
        }
        return result.workout;
      }
      
      // Placeholder functions for future implementation
      function getReplacementOptions(workoutPosition, workout) {
        if (workoutPosition >= workout.length) return [];
        const currentExercise = workout[workoutPosition];
        return ExerciseDatabase.getExercisesByMuscleGroup(currentExercise.muscleGroup)
          .filter(ex => ex.id !== currentExercise.id);
      }
      
      function replaceExercise(workout, index, newExercise) {
        const oldExercise = workout[index];
        workout[index] = newExercise;
        return {
          success: true,
          message: `Replaced "${oldExercise.name}" with "${newExercise.name}"`
        };
      }
      
      function undoReplacement() {
        return { success: false, message: 'No replacements to undo' };
      }
      
      function redoReplacement() {
        return { success: false, message: 'No replacements to redo' };
      }
      
      function getReplacementHistoryStatus() {
        return { canUndo: false, canRedo: false };
      }
      
      function clearReplacementHistory() {}
      
      return {
        generateRandomWorkout,
        generateQuickWorkout,
        getReplacementOptions,
        replaceExercise,
        undoReplacement,
        redoReplacement,
        getReplacementHistoryStatus,
        clearReplacementHistory
      };
    })();
  </script>
  
  <!-- UI Controller Module (Simplified) -->
  <script>
    const UIController = (() => {
      let elements = {};
      let currentWorkout = [];
      let currentMode = 'regenerate';
      
      function cacheElements() {
        elements = {
          workoutForm: document.getElementById('workoutForm'),
          exerciseCount: document.getElementById('exerciseCount'),
          exerciseCountDisplay: document.getElementById('exerciseCountDisplay'),
          operationModeInputs: document.querySelectorAll('input[name="operationMode"]'),
          muscleGroupInputs: document.querySelectorAll('input[name="muscleGroups"]'),
          generateBtn: document.getElementById('generateBtn'),
          clearBtn: document.getElementById('clearBtn'),
          loadingState: document.getElementById('loadingState'),
          errorState: document.getElementById('errorState'),
          emptyState: document.getElementById('emptyState'),
          workoutList: document.getElementById('workoutList'),
          exerciseList: document.getElementById('exerciseList'),
          workoutHeader: document.getElementById('workoutHeader'),
          workoutCount: document.getElementById('workoutCount'),
          workoutGroups: document.getElementById('workoutGroups'),
          workoutActions: document.getElementById('workoutActions'),
          errorMessage: document.getElementById('errorMessage'),
          workoutAnnouncements: document.getElementById('workoutAnnouncements')
        };
      }
      
      function setupEventListeners() {
        elements.workoutForm.addEventListener('submit', handleWorkoutGeneration);
        elements.exerciseCount.addEventListener('input', handleExerciseCountChange);
        elements.operationModeInputs.forEach(input => {
          input.addEventListener('change', handleOperationModeChange);
        });
        if (elements.clearBtn) {
          elements.clearBtn.addEventListener('click', handleClearWorkout);
        }
      }
      
      function handleWorkoutGeneration(event) {
        event.preventDefault();
        
        const formData = getFormData();
        showLoadingState();
        
        setTimeout(() => {
          try {
            const result = ExerciseGenerator.generateRandomWorkout(
              formData.exerciseCount,
              formData.enabledGroups
            );
            
            if (result.success) {
              displayWorkout(result.workout, result.metadata);
              announceToScreenReader(`Workout generated with ${result.workout.length} exercises`);
            } else {
              showErrorState(result.error || 'Failed to generate workout');
            }
          } catch (error) {
            showErrorState(error.message);
          }
        }, 300);
      }
      
      function getFormData() {
        const exerciseCount = parseInt(elements.exerciseCount.value, 10);
        const operationMode = Array.from(elements.operationModeInputs)
          .find(input => input.checked)?.value || 'regenerate';
        const enabledGroups = Array.from(elements.muscleGroupInputs)
          .filter(input => input.checked)
          .map(input => input.value);
        
        return { exerciseCount, operationMode, enabledGroups };
      }
      
      function handleExerciseCountChange(event) {
        elements.exerciseCountDisplay.textContent = event.target.value;
      }
      
      function handleOperationModeChange(event) {
        currentMode = event.target.value;
      }
      
      function handleClearWorkout() {
        currentWorkout = [];
        showEmptyState();
        elements.clearBtn.disabled = true;
        announceToScreenReader('Workout cleared');
      }
      
      function displayWorkout(workout, metadata = {}) {
        currentWorkout = [...workout];
        hideAllStates();
        renderWorkoutList(workout);
        updateWorkoutMetadata(workout, metadata);
        
        elements.workoutHeader.hidden = false;
        elements.workoutList.hidden = false;
        elements.workoutActions.hidden = false;
        elements.clearBtn.disabled = false;
      }
      
      function renderWorkoutList(workout) {
        elements.exerciseList.innerHTML = '';
        
        workout.forEach((exercise, index) => {
          const li = document.createElement('li');
          li.className = 'exercise-list__item';
          
          const card = document.createElement('div');
          card.className = 'exercise-card';
          
          card.innerHTML = `
            <div class="exercise-card__number">${index + 1}</div>
            <div class="exercise-card__content">
              <h4 class="exercise-card__name">${exercise.name}</h4>
              <span class="exercise-card__muscle-group">${exercise.muscleGroup}</span>
            </div>
          `;
          
          li.appendChild(card);
          elements.exerciseList.appendChild(li);
        });
      }
      
      function updateWorkoutMetadata(workout, metadata) {
        if (elements.workoutCount) {
          elements.workoutCount.textContent = `${workout.length} exercise${workout.length !== 1 ? 's' : ''}`;
        }
        if (elements.workoutGroups && metadata.muscleGroupsUsed) {
          elements.workoutGroups.textContent = `Muscle groups: ${metadata.muscleGroupsUsed.join(', ')}`;
        }
      }
      
      function showLoadingState() {
        hideAllStates();
        elements.loadingState.hidden = false;
        elements.generateBtn.disabled = true;
      }
      
      function showErrorState(message) {
        hideAllStates();
        elements.errorState.hidden = false;
        if (elements.errorMessage) {
          elements.errorMessage.textContent = message;
        }
        elements.generateBtn.disabled = false;
      }
      
      function showEmptyState() {
        hideAllStates();
        elements.emptyState.hidden = false;
        elements.generateBtn.disabled = false;
      }
      
      function hideAllStates() {
        const states = ['loadingState', 'errorState', 'emptyState', 'workoutHeader', 'workoutList', 'workoutActions'];
        states.forEach(state => {
          if (elements[state]) elements[state].hidden = true;
        });
        elements.generateBtn.disabled = false;
      }
      
      function announceToScreenReader(message) {
        if (elements.workoutAnnouncements) {
          elements.workoutAnnouncements.textContent = message;
          setTimeout(() => elements.workoutAnnouncements.textContent = '', 1000);
        }
      }
      
      function init() {
        cacheElements();
        setupEventListeners();
        showEmptyState();
        handleExerciseCountChange({ target: elements.exerciseCount });
      }
      
      return {
        init,
        displayWorkout,
        showLoadingState,
        showErrorState,
        showEmptyState,
        getState: () => ({ currentWorkout, currentMode })
      };
    })();
  </script>
  
  <!-- App Initialization -->
  <script>
    const WorkoutApp = (() => {
      function init() {
        try {
          console.log('🚀 Starting Workout Generator...');
          
          // Initialize modules
          ExerciseDatabase.initializeDatabase();
          UIController.init();
          
          console.log('✅ Workout Generator initialized successfully!');
          return { success: true };
        } catch (error) {
          console.error('❌ Initialization failed:', error);
          return { success: false, error: error.message };
        }
      }
      
      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        setTimeout(init, 0);
      }
      
      return { init };
    })();
  </script>

</body>
</html>
