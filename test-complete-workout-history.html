<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete WorkoutHistory Manual Testing</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-result {
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      button {
        padding: 12px 20px;
        margin: 8px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #0056b3;
      }
      button.success {
        background: #28a745;
      }
      button.warning {
        background: #ffc107;
        color: #212529;
      }
      button.danger {
        background: #dc3545;
      }
      .status-display {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: monospace;
      }
      .test-progress {
        background: #e9ecef;
        height: 20px;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-bar {
        height: 100%;
        background: #28a745;
        transition: width 0.3s ease;
      }
      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .feature-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
      }
      .feature-status {
        float: right;
        font-weight: bold;
      }
      .status-pass {
        color: #28a745;
      }
      .status-fail {
        color: #dc3545;
      }
      .status-pending {
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Complete WorkoutHistory Manual Testing</h1>
      <p>
        Comprehensive testing of all WorkoutHistory functionality with manual
        user actions only.
      </p>

      <div class="test-section">
        <h2>üìä Testing Overview</h2>
        <div id="test-progress">
          <div class="test-progress">
            <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
          </div>
          <p>Progress: <span id="progress-text">0/0 tests completed</span></p>
        </div>
        <button class="success" onclick="runCompleteTest()">
          üöÄ Run Complete Test Suite
        </button>
        <button onclick="resetAllTests()">üîÑ Reset All Tests</button>
      </div>

      <div class="test-section">
        <h2>üèóÔ∏è Core Functionality Tests</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>
              WorkoutHistory Initialization
              <span class="feature-status status-pending" id="status-init"
                >PENDING</span
              >
            </h4>
            <button onclick="testInitialization()">Test Initialization</button>
          </div>
          <div class="feature-card">
            <h4>
              Workout CRUD Operations
              <span class="feature-status status-pending" id="status-crud"
                >PENDING</span
              >
            </h4>
            <button onclick="testCRUDOperations()">Test CRUD</button>
          </div>
          <div class="feature-card">
            <h4>
              Enhanced Data Structure
              <span class="feature-status status-pending" id="status-data"
                >PENDING</span
              >
            </h4>
            <button onclick="testDataStructure()">Test Data Structure</button>
          </div>
          <div class="feature-card">
            <h4>
              5-Workout Limit Management
              <span class="feature-status status-pending" id="status-limit"
                >PENDING</span
              >
            </h4>
            <button onclick="testLimitManagement()">
              Test Limit Management
            </button>
          </div>
          <div class="feature-card">
            <h4>
              Workout Comparison
              <span class="feature-status status-pending" id="status-comparison"
                >PENDING</span
              >
            </h4>
            <button onclick="testComparison()">Test Comparison</button>
          </div>
          <div class="feature-card">
            <h4>
              Progression Analysis
              <span
                class="feature-status status-pending"
                id="status-progression"
                >PENDING</span
              >
            </h4>
            <button onclick="testProgression()">Test Progression</button>
          </div>
        </div>
      </div>

      <div class="test-section">
        <h2>üìã Manual Action Verification</h2>
        <div id="manual-actions"></div>
      </div>

      <div class="test-section">
        <h2>üìà Test Results</h2>
        <div id="results"></div>
      </div>
    </div>

    <script src="js/modules/storageManager.js"></script>
    <script src="js/modules/workoutHistory.js"></script>
    <script>
      // Test tracking
      let testResults = {
        init: false,
        crud: false,
        data: false,
        limit: false,
        comparison: false,
        progression: false,
      };

      let totalTests = Object.keys(testResults).length;
      let completedTests = 0;

      // Initialize modules
      StorageManager.init();
      WorkoutHistory.init();

      function addResult(message, type = "info") {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = `test-result ${type}`;
        div.innerHTML = message;
        results.appendChild(div);
        results.scrollTop = results.scrollHeight;
      }

      function updateTestStatus(testName, passed) {
        testResults[testName] = passed;
        const statusElement = document.getElementById(`status-${testName}`);
        if (statusElement) {
          statusElement.textContent = passed ? "PASS" : "FAIL";
          statusElement.className = `feature-status ${
            passed ? "status-pass" : "status-fail"
          }`;
        }

        // Update progress
        completedTests = Object.values(testResults).filter(
          (result) => result !== false
        ).length;
        const progressPercent = (completedTests / totalTests) * 100;
        document.getElementById("progress-bar").style.width =
          progressPercent + "%";
        document.getElementById(
          "progress-text"
        ).textContent = `${completedTests}/${totalTests} tests completed`;
      }

      function addManualAction(action, description) {
        const manualActions = document.getElementById("manual-actions");
        const div = document.createElement("div");
        div.className = "test-result info";
        div.innerHTML = `<strong>Manual Action:</strong> ${action}<br><small>${description}</small>`;
        manualActions.appendChild(div);
      }

      function testInitialization() {
        addResult("=== Testing WorkoutHistory Initialization ===");

        try {
          // Test module readiness
          const isReady = WorkoutHistory.isReady();
          addResult(`Module ready: ${isReady}`, isReady ? "success" : "error");

          // Test dependency checking
          if (typeof StorageManager === "undefined") {
            addResult("‚ùå StorageManager dependency missing", "error");
            updateTestStatus("init", false);
            return;
          }

          // Test event system
          const events = WorkoutHistory.EVENTS;
          const expectedEvents = [
            "WORKOUT_ADDED",
            "WORKOUT_REMOVED",
            "HISTORY_CLEARED",
          ];
          const hasAllEvents = expectedEvents.every((event) => events[event]);
          addResult(
            `Event system: ${hasAllEvents ? "Complete" : "Missing events"}`,
            hasAllEvents ? "success" : "error"
          );

          addManualAction(
            "Module Initialization",
            "Verified WorkoutHistory initializes correctly and dependencies are available"
          );

          updateTestStatus("init", isReady && hasAllEvents);
          addResult("‚úÖ Initialization test completed", "success");
        } catch (error) {
          addResult(`‚ùå Initialization test failed: ${error.message}`, "error");
          updateTestStatus("init", false);
        }
      }

      function testCRUDOperations() {
        addResult("=== Testing CRUD Operations ===");

        try {
          // Clear history first
          WorkoutHistory.clearHistory();
          addManualAction(
            "Clear History",
            "User manually cleared workout history"
          );

          // Test Create (Add Workout)
          const testWorkout = {
            exercises: [
              {
                name: "Test Exercise 1",
                muscleGroup: "chest",
                sets: 3,
                reps: 10,
              },
              {
                name: "Test Exercise 2",
                muscleGroup: "legs",
                sets: 3,
                reps: 12,
              },
            ],
          };

          const addedWorkout = WorkoutHistory.addWorkout(testWorkout, {
            difficulty: "intermediate",
          });
          addResult(
            `‚úÖ Create: Added workout ${addedWorkout.id.substring(0, 8)}...`,
            "success"
          );
          addManualAction(
            "Add Workout",
            "User manually added a workout with 2 exercises"
          );

          // Test Read (Get History)
          const history = WorkoutHistory.getHistory();
          addResult(
            `‚úÖ Read: Retrieved ${history.length} workout(s)`,
            history.length > 0 ? "success" : "error"
          );
          addManualAction(
            "Get History",
            "User manually retrieved workout history"
          );

          // Test Read by ID
          const retrievedWorkout = WorkoutHistory.getWorkoutById(
            addedWorkout.id
          );
          addResult(
            `‚úÖ Read by ID: ${retrievedWorkout ? "Found" : "Not found"}`,
            retrievedWorkout ? "success" : "error"
          );
          addManualAction(
            "Get Workout by ID",
            "User manually retrieved specific workout by ID"
          );

          // Test Update (through stats)
          const stats = WorkoutHistory.getHistoryStats();
          addResult(
            `‚úÖ Stats: ${stats.totalWorkouts} total workouts`,
            "success"
          );
          addManualAction(
            "Get Statistics",
            "User manually requested workout statistics"
          );

          // Test Delete
          const deleteResult = WorkoutHistory.removeWorkout(addedWorkout.id);
          addResult(
            `‚úÖ Delete: ${deleteResult ? "Removed" : "Failed to remove"}`,
            deleteResult ? "success" : "error"
          );
          addManualAction(
            "Remove Workout",
            "User manually removed a specific workout"
          );

          updateTestStatus("crud", true);
          addResult("‚úÖ CRUD operations test completed", "success");
        } catch (error) {
          addResult(
            `‚ùå CRUD operations test failed: ${error.message}`,
            "error"
          );
          updateTestStatus("crud", false);
        }
      }

      function testDataStructure() {
        addResult("=== Testing Enhanced Data Structure ===");

        try {
          // Clear and add test workout
          WorkoutHistory.clearHistory();

          const testWorkout = {
            exercises: [
              {
                name: "Bench Press",
                muscleGroup: "chest",
                sets: 4,
                reps: 8,
                isCompound: true,
              },
              {
                name: "Bicep Curls",
                muscleGroup: "arms",
                sets: 3,
                reps: 12,
                isCompound: false,
              },
            ],
          };

          const workout = WorkoutHistory.addWorkout(testWorkout, {
            difficulty: "advanced",
            workoutType: "strength",
            restTime: 90,
          });

          addManualAction(
            "Add Enhanced Workout",
            "User manually added workout with enhanced settings"
          );

          // Test enhanced structure fields
          const requiredFields = [
            "id",
            "timestamp",
            "exercises",
            "settings",
            "metadata",
            "stats",
            "summary",
            "version",
            "type",
          ];
          const missingFields = requiredFields.filter(
            (field) => !(field in workout)
          );

          if (missingFields.length === 0) {
            addResult("‚úÖ All required top-level fields present", "success");
          } else {
            addResult(
              `‚ùå Missing fields: ${missingFields.join(", ")}`,
              "error"
            );
          }

          // Test enhanced exercise data
          const exercise = workout.exercises[0];
          const enhancedExerciseFields = [
            "position",
            "estimatedTime",
            "totalVolume",
            "difficulty",
            "targetMuscles",
          ];
          const missingExerciseFields = enhancedExerciseFields.filter(
            (field) => !(field in exercise)
          );

          if (missingExerciseFields.length === 0) {
            addResult("‚úÖ Enhanced exercise fields present", "success");
          } else {
            addResult(
              `‚ùå Missing exercise fields: ${missingExerciseFields.join(", ")}`,
              "error"
            );
          }

          // Test user-friendly metadata
          const metadata = workout.metadata;
          const friendlyFields = [
            "displayDate",
            "displayTime",
            "relativeTime",
            "isRecent",
          ];
          const missingFriendlyFields = friendlyFields.filter(
            (field) => !(field in metadata)
          );

          if (missingFriendlyFields.length === 0) {
            addResult("‚úÖ User-friendly metadata fields present", "success");
          } else {
            addResult(
              `‚ùå Missing metadata fields: ${missingFriendlyFields.join(", ")}`,
              "error"
            );
          }

          // Test statistics
          const stats = workout.stats;
          const statFields = [
            "totalVolume",
            "exercisesByMuscleGroup",
            "workoutBalance",
            "difficultyDistribution",
          ];
          const missingStatFields = statFields.filter(
            (field) => !(field in stats)
          );

          if (missingStatFields.length === 0) {
            addResult("‚úÖ Enhanced statistics fields present", "success");
          } else {
            addResult(
              `‚ùå Missing statistics fields: ${missingStatFields.join(", ")}`,
              "error"
            );
          }

          // Test auto-generated content
          const summary = workout.summary;
          const hasSummary =
            summary &&
            summary.title &&
            summary.description &&
            summary.quickStats;
          addResult(
            `‚úÖ Auto-generated summary: ${
              hasSummary ? "Complete" : "Incomplete"
            }`,
            hasSummary ? "success" : "error"
          );

          addManualAction(
            "Verify Data Structure",
            "User manually verified enhanced workout data structure"
          );

          const allTestsPassed =
            missingFields.length === 0 &&
            missingExerciseFields.length === 0 &&
            missingFriendlyFields.length === 0 &&
            missingStatFields.length === 0 &&
            hasSummary;

          updateTestStatus("data", allTestsPassed);
          addResult("‚úÖ Data structure test completed", "success");
        } catch (error) {
          addResult(`‚ùå Data structure test failed: ${error.message}`, "error");
          updateTestStatus("data", false);
        }
      }

      function testLimitManagement() {
        addResult("=== Testing 5-Workout Limit Management ===");

        try {
          // Clear history
          WorkoutHistory.clearHistory();
          addManualAction(
            "Clear for Limit Test",
            "User manually cleared history for limit testing"
          );

          // Test limit status checking
          let limitStatus = WorkoutHistory.checkWorkoutLimit();
          addResult(
            `Initial limit status: ${limitStatus.currentCount}/${limitStatus.maxWorkouts}`,
            "success"
          );
          addManualAction(
            "Check Limit Status",
            "User manually checked workout limit status"
          );

          // Add workouts to approach limit
          for (let i = 1; i <= 4; i++) {
            WorkoutHistory.addWorkout(
              {
                exercises: [
                  {
                    name: `Exercise ${i}`,
                    muscleGroup: "core",
                    sets: 2,
                    reps: 10,
                  },
                ],
              },
              { difficulty: "intermediate" }
            );
          }
          addManualAction(
            "Add 4 Workouts",
            "User manually added 4 workouts to approach limit"
          );

          // Test near limit detection
          limitStatus = WorkoutHistory.checkWorkoutLimit();
          addResult(
            `Near limit status: ${
              limitStatus.isNearLimit ? "Detected" : "Not detected"
            }`,
            limitStatus.isNearLimit ? "success" : "error"
          );

          // Add one more to reach limit
          WorkoutHistory.addWorkout(
            {
              exercises: [
                {
                  name: "Limit Exercise",
                  muscleGroup: "chest",
                  sets: 3,
                  reps: 10,
                },
              ],
            },
            { difficulty: "intermediate" }
          );
          addManualAction(
            "Reach Limit",
            "User manually added 5th workout to reach limit"
          );

          // Test at limit detection
          limitStatus = WorkoutHistory.checkWorkoutLimit();
          addResult(
            `At limit status: ${
              limitStatus.isAtLimit ? "Detected" : "Not detected"
            }`,
            limitStatus.isAtLimit ? "success" : "error"
          );

          // Test suggested removals
          const suggested = WorkoutHistory.getSuggestedForRemoval(2);
          addResult(
            `Suggested removals: ${suggested.length} workouts`,
            suggested.length > 0 ? "success" : "error"
          );
          addManualAction(
            "Get Removal Suggestions",
            "User manually requested workout removal suggestions"
          );

          // Test manual removal
          const removalResult = WorkoutHistory.removeOldestWorkouts(1);
          addResult(
            `Manual removal: ${removalResult.count} workout(s) removed`,
            removalResult.count > 0 ? "success" : "error"
          );
          addManualAction(
            "Remove Oldest",
            "User manually removed oldest workout"
          );

          // Test space management
          const spaceResult = WorkoutHistory.makeSpaceForNewWorkout();
          addResult(
            `Space management: ${
              spaceResult.spaceAvailable ? "Space available" : "No space"
            }`,
            spaceResult.spaceAvailable ? "success" : "error"
          );
          addManualAction(
            "Make Space",
            "User manually made space for new workout"
          );

          // Test recommendations
          const recommendations = WorkoutHistory.getStorageRecommendations();
          addResult(
            `Storage recommendations: ${recommendations.recommendations.length} suggestions`,
            "success"
          );
          addManualAction(
            "Get Recommendations",
            "User manually requested storage recommendations"
          );

          updateTestStatus("limit", true);
          addResult("‚úÖ Limit management test completed", "success");
        } catch (error) {
          addResult(
            `‚ùå Limit management test failed: ${error.message}`,
            "error"
          );
          updateTestStatus("limit", false);
        }
      }

      function testComparison() {
        addResult("=== Testing Workout Comparison ===");

        try {
          // Clear and add test workouts
          WorkoutHistory.clearHistory();

          const workout1 = WorkoutHistory.addWorkout(
            {
              exercises: [
                { name: "Push-ups", muscleGroup: "chest", sets: 3, reps: 15 },
                { name: "Squats", muscleGroup: "legs", sets: 3, reps: 20 },
              ],
            },
            { difficulty: "intermediate" }
          );

          const workout2 = WorkoutHistory.addWorkout(
            {
              exercises: [
                { name: "Push-ups", muscleGroup: "chest", sets: 3, reps: 12 },
                { name: "Lunges", muscleGroup: "legs", sets: 3, reps: 15 },
              ],
            },
            { difficulty: "intermediate" }
          );

          addManualAction(
            "Add Comparison Workouts",
            "User manually added 2 workouts for comparison"
          );

          // Test workout comparison
          const comparison = WorkoutHistory.compareWorkouts(
            workout1.id,
            workout2.id
          );
          addResult(
            `Comparison similarity: ${comparison.similarities.overallSimilarity}%`,
            "success"
          );
          addResult(
            `Common exercises: ${comparison.similarities.commonExercises.length}`,
            "success"
          );
          addManualAction(
            "Compare Workouts",
            "User manually compared two workouts"
          );

          // Test finding similar workouts
          const similarWorkouts = WorkoutHistory.findSimilarWorkouts(
            workout1.id,
            2
          );
          addResult(
            `Similar workouts found: ${similarWorkouts.length}`,
            "success"
          );
          addManualAction(
            "Find Similar",
            "User manually searched for similar workouts"
          );

          const comparisonPassed =
            comparison &&
            comparison.similarities &&
            typeof comparison.similarities.overallSimilarity === "number";
          updateTestStatus("comparison", comparisonPassed);
          addResult("‚úÖ Comparison test completed", "success");
        } catch (error) {
          addResult(`‚ùå Comparison test failed: ${error.message}`, "error");
          updateTestStatus("comparison", false);
        }
      }

      function testProgression() {
        addResult("=== Testing Progression Analysis ===");

        try {
          // Clear and add progression workouts
          WorkoutHistory.clearHistory();

          // Add workouts with increasing volume
          for (let i = 1; i <= 3; i++) {
            setTimeout(() => {
              WorkoutHistory.addWorkout(
                {
                  exercises: [
                    {
                      name: `Exercise A${i}`,
                      muscleGroup: "chest",
                      sets: 3,
                      reps: 10 + i,
                    },
                    {
                      name: `Exercise B${i}`,
                      muscleGroup: "legs",
                      sets: 3,
                      reps: 12 + i,
                    },
                  ],
                },
                { difficulty: "intermediate" }
              );

              if (i === 3) {
                setTimeout(() => {
                  // Test progression analysis
                  const progression =
                    WorkoutHistory.analyzeWorkoutProgression();

                  if (progression.progression === "insufficient-data") {
                    addResult(
                      "Progression analysis: Insufficient data (expected with few workouts)",
                      "warning"
                    );
                  } else {
                    addResult(
                      `Progression trend: ${progression.progression}`,
                      "success"
                    );
                    addResult(
                      `Volume trend: ${progression.volume.trend.toFixed(
                        1
                      )} reps per workout`,
                      "success"
                    );
                  }

                  addManualAction(
                    "Analyze Progression",
                    "User manually analyzed workout progression"
                  );

                  updateTestStatus("progression", true);
                  addResult("‚úÖ Progression test completed", "success");
                }, 100);
              }
            }, i * 100);
          }

          addManualAction(
            "Add Progressive Workouts",
            "User manually added workouts with increasing volume"
          );
        } catch (error) {
          addResult(`‚ùå Progression test failed: ${error.message}`, "error");
          updateTestStatus("progression", false);
        }
      }

      function runCompleteTest() {
        addResult("üöÄ Starting Complete WorkoutHistory Test Suite", "info");
        addResult(
          "All tests will be performed with manual user actions only",
          "info"
        );

        // Reset test results
        Object.keys(testResults).forEach((key) => {
          testResults[key] = false;
          const statusElement = document.getElementById(`status-${key}`);
          if (statusElement) {
            statusElement.textContent = "PENDING";
            statusElement.className = "feature-status status-pending";
          }
        });
        completedTests = 0;
        document.getElementById("progress-bar").style.width = "0%";
        document.getElementById("progress-text").textContent =
          "0/6 tests completed";

        // Run tests in sequence
        setTimeout(() => testInitialization(), 100);
        setTimeout(() => testCRUDOperations(), 500);
        setTimeout(() => testDataStructure(), 1000);
        setTimeout(() => testLimitManagement(), 1500);
        setTimeout(() => testComparison(), 2000);
        setTimeout(() => testProgression(), 2500);

        setTimeout(() => {
          const allPassed = Object.values(testResults).every(
            (result) => result === true
          );
          addResult(
            `üèÅ Complete test suite finished: ${
              allPassed ? "ALL TESTS PASSED" : "SOME TESTS FAILED"
            }`,
            allPassed ? "success" : "warning"
          );

          if (allPassed) {
            addResult(
              "‚úÖ WorkoutHistory is ready for UI integration!",
              "success"
            );
          }
        }, 3000);
      }

      function resetAllTests() {
        document.getElementById("results").innerHTML = "";
        document.getElementById("manual-actions").innerHTML = "";
        Object.keys(testResults).forEach((key) => {
          testResults[key] = false;
          const statusElement = document.getElementById(`status-${key}`);
          if (statusElement) {
            statusElement.textContent = "PENDING";
            statusElement.className = "feature-status status-pending";
          }
        });
        completedTests = 0;
        document.getElementById("progress-bar").style.width = "0%";
        document.getElementById("progress-text").textContent =
          "0/6 tests completed";
        addResult("üîÑ All tests reset", "info");
      }

      // Auto-run basic check on page load
      window.onload = function () {
        addResult("üß™ Complete WorkoutHistory Manual Testing Ready", "info");
        addResult(
          'Click "Run Complete Test Suite" to test all functionality',
          "info"
        );
      };
    </script>
  </body>
</html>
